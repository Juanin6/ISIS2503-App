<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ofipensiones - Buscar Reportes</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <script>
        function buscarReportes(tipo) {
            // Obtener credenciales según el tipo de usuario
            const correo = tipo === 'admin' ? 'admin@example.com' : document.getElementById('username').value;
            const contrasena = tipo === 'admin' ? document.getElementById('admin-password').value : document.getElementById('user-password').value;

            // Mostrar spinner mientras se procesa
            const reportesContainer = document.getElementById('reportes');
            reportesContainer.innerHTML = '<div class="text-center"><div class="spinner-border" role="status"><span class="sr-only">Cargando...</span></div></div>';

            fetch('/ver-reportes/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ correo: correo, contrasena: contrasena })
            })
            .then(response => response.json())
            .then(data => {
                reportesContainer.innerHTML = ""; // Limpiar contenedor

                if (data.response === "true") {
                    mostrarReportes(tipo, data.reportes);
                } else {
                    reportesContainer.innerHTML = `<div class="alert alert-danger">${data.message}</div>`;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                reportesContainer.innerHTML = '<div class="alert alert-danger">Ocurrió un error al procesar la solicitud.</div>';
            });
        }

        function mostrarReportes(tipo, reportes) {
            const reportesContainer = document.getElementById('reportes');

            if (reportes.length === 0) {
                reportesContainer.innerHTML = '<div class="alert alert-info">No se encontraron reportes.</div>';
                return;
            }

            reportes.forEach(reporte => {
                const div = document.createElement('div');
                div.className = 'card mb-3';
                div.innerHTML = `
                    <div class="card-body">
                        <p><strong>Concepto de Pago:</strong> ${reporte.concepto_pago}</p>
                        <p><strong>Valor Pagado:</strong> ${reporte.valor_pagado}</p>
                        <p><strong>Saldo Pendiente:</strong> ${reporte.saldo_pendiente}</p>
                        <p><strong>Fecha de Emisión:</strong> ${reporte.fecha_emision}</p>
                    </div>
                `;
                reportesContainer.appendChild(div);
            });

            if (tipo === 'admin') {
                const mensaje = document.createElement('div');
                mensaje.className = 'alert alert-success';
                mensaje.innerHTML = 'Mostrando todos los reportes disponibles como administrador.';
                reportesContainer.prepend(mensaje);
            } else {
                const mensaje = document.createElement('div');
                mensaje.className = 'alert alert-success';
                mensaje.innerHTML = 'Mostrando tus reportes personales.';
                reportesContainer.prepend(mensaje);
            }
        }
    </script>
</head>
<body>
    <nav class="navbar navbar-light bg-light">
        <a class="navbar-brand" href="/">Ofipensiones</a>
    </nav>
    <div class="container mt-5">
        <h1 class="mb-4 text-center">Buscar Reportes</h1>
        <div class="row">
            <!-- Sección para Administrador -->
            <div class="col-md-6 mb-4">
                <h3>Administrador</h3>
                <div class="form-group">
                    <label for="admin-password">Contraseña de Administrador</label>
                    <input type="password" id="admin-password" class="form-control" placeholder="Ingrese la contraseña">
                </div>
                <button class="btn btn-primary btn-block" onclick="buscarReportes('admin')">Buscar como Administrador</button>
            </div>

            <!-- Sección para Usuario -->
            <div class="col-md-6 mb-4">
                <h3>Usuario</h3>
                <div class="form-group">
                    <label for="username">Correo</label>
                    <input type="text" id="username" class="form-control" placeholder="Ingrese su correo">
                </div>
                <div class="form-group">
                    <label for="user-password">Contraseña</label>
                    <input type="password" id="user-password" class="form-control" placeholder="Ingrese su contraseña">
                </div>
                <button class="btn btn-primary btn-block" onclick="buscarReportes('usuario')">Buscar como Usuario</button>
            </div>
        </div>

        <!-- Contenedor para mostrar reportes -->
        <div id="reportes" class="mt-5">
            <!-- Aquí se mostrarán los reportes -->
        </div>
    </div>
</body>
</html>
